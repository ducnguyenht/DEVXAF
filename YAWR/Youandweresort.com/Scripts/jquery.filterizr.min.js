/**
* Filterizr is a jQuery plugin that sorts, shuffles and applies stunning filters over
* responsive galleries using CSS3 transitions and custom CSS effects.
*
* @author Yiotis Kaltsikis
* @see {@link http://yiotis.net/filterizr}
* @version 1.2.3
* @license MIT License
*/
(function(n,t){"use strict";var i,r;if(!t)throw new Error("Filterizr requires jQuery to work.");i=function(n){this.init(n)};i.prototype={init:function(n){this.root={x:0,y:0,w:n}},fit:function(n){var i,r,t,u=n.length,f=u>0?n[0].h:0;for(this.root.h=f,i=0;i<u;i++)t=n[i],t.fit=(r=this.findNode(this.root,t.w,t.h))?this.splitNode(r,t.w,t.h):this.growDown(t.w,t.h)},findNode:function(n,t,i){return n.used?this.findNode(n.right,t,i)||this.findNode(n.down,t,i):t<=n.w&&i<=n.h?n:null},splitNode:function(n,t,i){return n.used=!0,n.down={x:n.x,y:n.y+i,w:n.w,h:n.h-i},n.right={x:n.x+t,y:n.y,w:n.w-t,h:i},n},growDown:function(n,t){var i;return this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+t,down:{x:0,y:this.root.h,w:this.root.w,h:t},right:this.root},(i=this.findNode(this.root,n,t))?this.splitNode(i,n,t):null}};t.fn.filterizr=function(){var i=this,n=arguments;if(i._fltr||(i._fltr=t.fn.filterizr.prototype.init(i.selector,typeof n[0]=="object"?n[0]:undefined)),typeof n[0]=="string"){if(n[0].lastIndexOf("_")>-1)throw new Error("Filterizr error: You cannot call private methods");if(typeof i._fltr[n[0]]=="function")i._fltr[n[0]](n[1],n[2]);else throw new Error("Filterizr error: There is no such function");}return i};t.fn.filterizr.prototype={init:function(n,i){var r=t(n).extend(t.fn.filterizr.prototype);return r.options={animationDuration:.5,callbacks:{onFilteringStart:function(){},onFilteringEnd:function(){},onShufflingStart:function(){},onShufflingEnd:function(){},onSortingStart:function(){},onSortingEnd:function(){}},delay:0,delayMode:"progressive",easing:"ease-out",filter:"all",filterOutCss:{opacity:0,transform:"scale(0.5)"},filterInCss:{opacity:1,transform:"scale(1)"},layout:"sameSize",selector:typeof n=="string"?n:".filtr-container",setupControls:!0},arguments.length===0&&(n=r.options.selector,i=r.options),arguments.length===1&&typeof arguments[0]=="object"&&(i=arguments[0]),i&&r.setOptions(i),r.css({padding:0,position:"relative"}),r._lastCategory=0,r._isAnimating=!1,r._isShuffling=!1,r._isSorting=!1,r._mainArray=r._getFiltrItems(),r._subArrays=r._makeSubarrays(),r._activeArray=r._getCollectionByFilter(r.options.filter),r._toggledCategories={},r._typedText=t("input[data-search]").val()||"",r._uID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)}),r._setupEvents(),r.options.setupControls&&r._setupControls(),r.filter(r.options.filter),r},filter:function(n){var t=this,i=t._getCollectionByFilter(n);t.options.filter=n;t.trigger("filteringStart");t._handleFiltering(i);t._isSearchActivated()&&t.search(t._typedText)},toggleFilter:function(n){var t=this,i=[];t.trigger("filteringStart");n&&(t._toggledCategories[n]?delete t._toggledCategories[n]:t._toggledCategories[n]=!0);t._multifilterModeOn()?(i=t._makeMultifilterArray(),t._handleFiltering(i),t._isSearchActivated()&&t.search(t._typedText)):(t.filter("all"),t._isSearchActivated()&&t.search(t._typedText))},search:function(n){var t=this,r=t._multifilterModeOn()?t._makeMultifilterArray():t._getCollectionByFilter(t.options.filter),u=[],i=0,f;if(t._isSearchActivated())for(i=0;i<r.length;i++)f=r[i].text().toLowerCase().indexOf(n.toLowerCase())>-1,f&&u.push(r[i]);if(u.length>0)t._handleFiltering(u);else if(t._isSearchActivated())for(i=0;i<t._activeArray.length;i++)t._activeArray[i]._filterOut();else t._handleFiltering(r)},shuffle:function(){var n=this,t;n._isAnimating=!0;n._isShuffling=!0;n.trigger("shufflingStart");n._mainArray=n._fisherYatesShuffle(n._mainArray);n._subArrays=n._makeSubarrays();t=n._multifilterModeOn()?n._makeMultifilterArray():n._getCollectionByFilter(n.options.filter);n._isSearchActivated()?n.search(n._typedText):n._placeItems(t)},sort:function(n,t){var i=this,u,r,f;if(n=n||"domIndex",t=t||"asc",i._isAnimating=!0,i._isSorting=!0,i.trigger("sortingStart"),u=n!=="domIndex"&&n!=="sortData"&&n!=="w"&&n!=="h",u)for(r=0;r<i._mainArray.length;r++)i._mainArray[r][n]=i._mainArray[r].data(n);i._mainArray.sort(i._comparator(n,t));i._subArrays=i._makeSubarrays();f=i._multifilterModeOn()?i._makeMultifilterArray():i._getCollectionByFilter(i.options.filter);i._isSearchActivated()?i.search(i._typedText):i._placeItems(f)},setOptions:function(n){var t=this,i=0;for(var r in n)t.options[r]=n[r];if(t._mainArray&&(n.animationDuration||n.delay||n.easing||n.delayMode))for(i=0;i<t._mainArray.length;i++)t._mainArray[i].css("transition","all "+t.options.animationDuration+"s "+t.options.easing+" "+t._mainArray[i]._calcDelay()+"ms");n.callbacks&&(n.callbacks.onFilteringStart||(t.options.callbacks.onFilteringStart=function(){}),n.callbacks.onFilteringEnd||(t.options.callbacks.onFilteringEnd=function(){}),n.callbacks.onShufflingStart||(t.options.callbacks.onShufflingStart=function(){}),n.callbacks.onShufflingEnd||(t.options.callbacks.onShufflingEnd=function(){}),n.callbacks.onSortingStart||(t.options.callbacks.onSortingStart=function(){}),n.callbacks.onSortingEnd||(t.options.callbacks.onSortingEnd=function(){}));t.options.filterInCss.transform||(t.options.filterInCss.transform="translate3d(0,0,0)");t.options.filterOutCss.transform||(t.options.filterOutCss.transform="translate3d(0,0,0)")},_getFiltrItems:function(){var n=this,u=t(n.find(".filtr-item")),i=[];return t.each(u,function(u,f){var e=t(f).extend(r)._init(u,n);i.push(e)}),i},_makeSubarrays:function(){for(var u,r,t=this,i=[],n=0;n<t._lastCategory;n++)i.push([]);for(n=0;n<t._mainArray.length;n++)if(typeof t._mainArray[n]._category=="object")for(u=t._mainArray[n]._category.length,r=0;r<u;r++)i[t._mainArray[n]._category[r]-1].push(t._mainArray[n]);else i[t._mainArray[n]._category-1].push(t._mainArray[n]);return i},_makeMultifilterArray:function(){for(var i,t=this,f=[],e={},r=0;r<t._mainArray.length;r++){var n=t._mainArray[r],u=!1,o=n.domIndex in e==!1;if(Array.isArray(n._category)){for(i=0;i<n._category.length;i++)if(n._category[i]in t._toggledCategories){u=!0;break}}else n._category in t._toggledCategories&&(u=!0);o&&u&&(e[n.domIndex]=!0,f.push(n))}return f},_setupControls:function(){var n=this;t("*[data-filter]").click(function(){var i=t(this).data("filter");n.options.filter!==i&&n.filter(i)});t("*[data-multifilter]").click(function(){var i=t(this).data("multifilter");i==="all"?(n._toggledCategories={},n.filter("all")):n.toggleFilter(i)});t("*[data-shuffle]").click(function(){n.shuffle()});t("*[data-sortAsc]").click(function(){var i=t("*[data-sortOrder]").val();n.sort(i,"asc")});t("*[data-sortDesc]").click(function(){var i=t("*[data-sortOrder]").val();n.sort(i,"desc")});t("input[data-search]").keyup(function(){n._typedText=t(this).val();n._delayEvent(function(){n.search(n._typedText)},250,n._uID)})},_setupEvents:function(){var i=this;t(n).resize(function(){i._delayEvent(function(){i.trigger("resizeFiltrContainer")},250,i._uID)});i.on("resizeFiltrContainer",function(){i._multifilterModeOn()?i.toggleFilter():i.filter(i.options.filter)}).on("filteringStart",function(){i.options.callbacks.onFilteringStart()}).on("filteringEnd",function(){i.options.callbacks.onFilteringEnd()}).on("shufflingStart",function(){i._isShuffling=!0;i.options.callbacks.onShufflingStart()}).on("shufflingEnd",function(){i.options.callbacks.onShufflingEnd();i._isShuffling=!1}).on("sortingStart",function(){i._isSorting=!0;i.options.callbacks.onSortingStart()}).on("sortingEnd",function(){i.options.callbacks.onSortingEnd();i._isSorting=!1})},_calcItemPositions:function(){var u=this,r=u._activeArray,o=0,h=Math.round(u.width()/u.find(".filtr-item").outerWidth()),s=0,a=r[0].outerWidth(),y=0,f=0,e=0,n=0,c=0,l=[],w,k,d,b,v,p;if(u.options.layout==="packed"){for(t.each(u._activeArray,function(n,t){t._updateDimensions()}),w=new i(u.outerWidth()),w.fit(u._activeArray),n=0;n<r.length;n++)l.push({left:r[n].fit.x,top:r[n].fit.y});o=w.root.h}if(u.options.layout==="horizontal")for(s=1,n=1;n<=r.length;n++)a=r[n-1].outerWidth(),y=r[n-1].outerHeight(),l.push({left:f,top:e}),f+=a,o<y&&(o=y);else if(u.options.layout==="vertical"){for(n=1;n<=r.length;n++)y=r[n-1].outerHeight(),l.push({left:f,top:e}),e+=y;o=e}else if(u.options.layout==="sameHeight"){for(s=1,k=u.outerWidth(),n=1;n<=r.length;n++)a=r[n-1].width(),d=r[n-1].outerWidth(),b=0,r[n]&&(b=r[n].width()),l.push({left:f,top:e}),c=f+a+b,c>k?(c=0,f=0,e+=r[0].outerHeight(),s++):f+=d;o=s*r[0].outerHeight()}else if(u.options.layout==="sameWidth"){for(n=1;n<=r.length;n++){if(l.push({left:f,top:e}),n%h==0&&s++,f+=a,e=0,s>0)for(c=s;c>0;)e+=r[n-h*c].outerHeight(),c--;n%h==0&&(f=0)}for(n=0;n<h;n++){for(v=0,p=n;r[p];)v+=r[p].outerHeight(),p+=h;v>o?(o=v,v=0):v=0}}else if(u.options.layout==="sameSize"){for(n=1;n<=r.length;n++)l.push({left:f,top:e}),f+=a,n%h==0&&(e+=r[0].outerHeight(),f=0);s=Math.ceil(r.length/h);o=s*r[0].outerHeight()}return u.css("height",o),l},_handleFiltering:function(n){for(var t=this,r=t._getArrayOfUniqueItems(t._activeArray,n),i=0;i<r.length;i++)r[i]._filterOut();t._activeArray=n;t._placeItems(n)},_multifilterModeOn:function(){var n=this;return Object.keys(n._toggledCategories).length>0},_isSearchActivated:function(){var n=this;return n._typedText.length>0},_placeItems:function(n){var i=this,t;for(i._isAnimating=!0,i._itemPositions=i._calcItemPositions(),t=0;t<n.length;t++)n[t]._filterIn(i._itemPositions[t])},_getCollectionByFilter:function(n){var t=this;return n==="all"?t._mainArray:t._subArrays[n-1]},_makeDeepCopy:function(n){var t={};for(var i in n)t[i]=n[i];return t},_comparator:function(n,t){return function(i,r){return t==="asc"?i[n]<r[n]?-1:i[n]>r[n]?1:0:t==="desc"?r[n]<i[n]?-1:r[n]>i[n]?1:0:void 0}},_getArrayOfUniqueItems:function(n,t){for(var f=[],e={},r=t.length,u,i=0;i<r;i++)e[t[i].domIndex]=!0;for(r=n.length,i=0;i<r;i++)u=n[i],u.domIndex in e||f.push(u);return f},_delayEvent:function(){var t=this,n={};return function(t,i,r){if(r===null)throw Error("UniqueID needed");n[r]&&clearTimeout(n[r]);n[r]=setTimeout(t,i)}}(),_fisherYatesShuffle:function(n){for(var t=n.length,r,i;t;)i=Math.floor(Math.random()*t--),r=n[t],n[t]=n[i],n[i]=r;return n}};r={_init:function(n,t){var i=this;i._parent=t;i._category=i._getCategory();i._lastPos={};i.domIndex=n;i.sortData=i.data("sort");i.w=0;i.h=0;i._isFilteredOut=!0;i._filteringOut=!1;i._filteringIn=!1;i.css(t.options.filterOutCss).css({"-webkit-backface-visibility":"hidden",perspective:"1000px","-webkit-perspective":"1000px","-webkit-transform-style":"preserve-3d",position:"absolute",transition:"all "+t.options.animationDuration+"s "+t.options.easing+" "+i._calcDelay()+"ms"});i.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){i._onTransitionEnd()});return i},_updateDimensions:function(){var n=this;n.w=n.outerWidth();n.h=n.outerHeight()},_calcDelay:function(){var n=this,t=0;return n._parent.options.delayMode==="progressive"?t=n._parent.options.delay*n.domIndex:n.domIndex%2==0&&(t=n._parent.options.delay),t},_getCategory:function(){var i=this,n=i.data("category"),t;if(typeof n=="string")for(n=n.split(", "),t=0;t<n.length;t++){if(isNaN(parseInt(n[t])))throw new Error("Filterizr: the value of data-category must be a number, starting from value 1 and increasing.");parseInt(n[t])>i._parent._lastCategory&&(i._parent._lastCategory=parseInt(n[t]))}else n>i._parent._lastCategory&&(i._parent._lastCategory=n);return n},_onTransitionEnd:function(){var n=this;n._filteringOut?(t(n).addClass("filteredOut"),n._isFilteredOut=!0,n._filteringOut=!1):n._filteringIn&&(n._isFilteredOut=!1,n._filteringIn=!1);n._parent._isAnimating&&(n._parent._isShuffling?n._parent.trigger("shufflingEnd"):n._parent._isSorting?n._parent.trigger("sortingEnd"):n._parent.trigger("filteringEnd"),n._parent._isAnimating=!1)},_filterOut:function(){var n=this,t=n._parent._makeDeepCopy(n._parent.options.filterOutCss);t.transform+=" translate3d("+n._lastPos.left+"px,"+n._lastPos.top+"px, 0)";n.css(t);n.css("pointer-events","none");n._filteringOut=!0},_filterIn:function(n){var i=this,r=i._parent._makeDeepCopy(i._parent.options.filterInCss);t(i).removeClass("filteredOut");i._filteringIn=!0;i._lastPos=n;i.css("pointer-events","auto");r.transform+=" translate3d("+n.left+"px,"+n.top+"px, 0)";i.css(r)}}})(this,jQuery);